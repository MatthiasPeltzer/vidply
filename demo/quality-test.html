<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VidPly - Quality Switching Test</title>
  <link rel="icon" type="image/svg+xml" href="../favicon.svg">
  <link rel="stylesheet" href="../dist/vidply.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      color: #ffffff;
      padding: 40px 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      font-size: 36px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .subtitle {
      font-size: 18px;
      opacity: 0.8;
      margin-bottom: 20px;
    }

    .test-section {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .test-section h2 {
      font-size: 24px;
      margin-bottom: 16px;
      color: #fff;
    }

    .test-section p {
      color: #ccc;
      margin-bottom: 20px;
    }

    .player-container {
      max-width: 900px;
      margin: 0 auto 24px;
    }

    .info-card {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: 20px;
    }

    .info-card h3 {
      font-size: 16px;
      color: #4caf50;
      margin-bottom: 12px;
    }

    .info-card ul {
      list-style-position: inside;
      color: #ccc;
      line-height: 2;
    }

    .info-card ul li {
      padding-left: 10px;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .back-link:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      margin: 5px;
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }

    .code-block {
      background: #000;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      overflow-x: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .code-block code {
      color: #4caf50;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 28px;
      }

      .test-section {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="demo.html" class="back-link">‚Üê Back to Demo</a>

    <header>
      <h1>
        <img src="../favicon.svg" width="32" alt="VidPly" />
        Quality Switching Test
      </h1>
      <p class="subtitle">Test quality switching for both HLS and multiple HTML5 sources</p>
    </header>

    <!-- HLS Test Section -->
    <section class="test-section">
      <h2>HLS Adaptive Streaming</h2>
      <p>HLS streams automatically include multiple quality levels. Click the HD button to switch quality.</p>
      <span class="status">‚úì Auto quality switching</span>
      <span class="status">‚úì Manual quality selection</span>
      
      <div class="player-container">
        <video 
          id="hls-player"
          width="900"
          height="506"
          preload="metadata"
        >
          <source src="https://devstreaming-cdn.apple.com/videos/streaming/examples/img_bipbop_adv_example_fmp4/master.m3u8" type="application/x-mpegURL">
          Your browser does not support HLS streaming.
        </video>
      </div>

      <div class="info-card">
        <h3>How it works:</h3>
        <ul>
          <li>VidPly detects HLS stream (.m3u8)</li>
          <li>Multiple quality levels are automatically parsed</li>
          <li>Click the HD button to see all available qualities</li>
          <li>Select "Auto" for adaptive bitrate switching</li>
          <li>Or manually select a specific quality (360p, 720p, 1080p, etc.)</li>
        </ul>
      </div>
    </section>

    <!-- Multiple Sources Test Section -->
    <section class="test-section">
      <h2>Multiple HTML5 Sources</h2>
      <p>Use multiple &lt;source&gt; elements with quality labels to enable manual quality switching.</p>
      <span class="status">‚úì Multiple source elements</span>
      <span class="status">‚úì Data attributes for quality info</span>
      
      <div class="player-container">
        <video 
          id="multi-quality-player"
          width="900"
          height="506"
          preload="metadata"
        >
          <!-- Note: These are example URLs - replace with actual video sources at different qualities -->
          <source 
            src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" 
            type="video/mp4"
            data-quality="720p"
            data-height="720"
            data-width="1280"
            label="720p HD">
          <source 
            src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4" 
            type="video/mp4"
            data-quality="480p"
            data-height="480"
            data-width="854"
            label="480p">
          <source 
            src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4" 
            type="video/mp4"
            data-quality="360p"
            data-height="360"
            data-width="640"
            label="360p">
          Your browser does not support the video tag.
        </video>
      </div>

      <div class="info-card">
        <h3>How to use:</h3>
        <ul>
          <li>Add multiple &lt;source&gt; elements to your video</li>
          <li>Use <code>data-quality</code> or <code>label</code> attributes to specify quality</li>
          <li>Use <code>data-height</code> and <code>data-width</code> for dimensions</li>
          <li>VidPly will automatically detect and enable quality switching</li>
          <li>Click the HD button to switch between qualities</li>
        </ul>
      </div>

      <div class="code-block">
<code>&lt;video id="my-player"&gt;
  &lt;source 
    src="video-1080p.mp4" 
    type="video/mp4"
    data-quality="1080p"
    data-height="1080"
    data-width="1920"
    label="1080p Full HD"&gt;
  &lt;source 
    src="video-720p.mp4" 
    type="video/mp4"
    data-quality="720p"
    data-height="720"
    data-width="1280"
    label="720p HD"&gt;
  &lt;source 
    src="video-480p.mp4" 
    type="video/mp4"
    data-quality="480p"
    data-height="480"
    data-width="854"
    label="480p SD"&gt;
&lt;/video&gt;

&lt;script type="module"&gt;
  import Player from './vidply.esm.js';
  const player = new Player('#my-player');
&lt;/script&gt;</code>
      </div>
    </section>

    <!-- Features Section -->
    <section class="test-section">
      <h2>Quality Switching Features</h2>
      
      <div class="info-card">
        <h3>‚ú® Key Features:</h3>
        <ul>
          <li><strong>HLS Support:</strong> Automatic quality detection with adaptive bitrate streaming</li>
          <li><strong>Manual Selection:</strong> Users can manually select preferred quality</li>
          <li><strong>Seamless Switching:</strong> Maintains playback position when switching quality</li>
          <li><strong>Visual Indicator:</strong> Quality badge shows current resolution (e.g., "720p", "Auto")</li>
          <li><strong>Auto Mode (HLS):</strong> Let the player automatically choose best quality based on bandwidth</li>
          <li><strong>Multiple Sources:</strong> Works with standard HTML5 video with multiple source elements</li>
          <li><strong>Accessible:</strong> Keyboard navigation and ARIA labels for quality menu</li>
          <li><strong>Mobile Friendly:</strong> Touch-optimized quality selection menu</li>
        </ul>
      </div>
    </section>
  </div>

  <script type="module">
    import Player from '../src/index.js';

    // Initialize HLS player
    console.log('Initializing HLS player...');
    const hlsPlayer = new Player('#hls-player', {
      debug: true,
      controls: true,
      volume: 0.8,
      autoplay: false
    });

    // Store for debugging
    window.hlsPlayer = hlsPlayer;

    // Log quality events
    hlsPlayer.on('hlsmanifestparsed', (data) => {
      console.log('HLS manifest parsed. Quality levels:', data.levels);
    });

    hlsPlayer.on('hlslevelswitched', (data) => {
      console.log('HLS quality switched to level:', data.level);
    });

    // Initialize multi-quality player
    console.log('Initializing multi-quality player...');
    const multiQualityPlayer = new Player('#multi-quality-player', {
      debug: true,
      controls: true,
      volume: 0.8,
      autoplay: false
    });

    // Store for debugging
    window.multiQualityPlayer = multiQualityPlayer;

    // Log quality events
    multiQualityPlayer.on('qualitychange', (data) => {
      console.log('Quality changed to:', data.quality);
    });

    multiQualityPlayer.on('ready', () => {
      console.log('Multi-quality player ready');
      
      // Check if qualities were detected
      if (multiQualityPlayer.renderer && multiQualityPlayer.renderer.getQualities) {
        const qualities = multiQualityPlayer.renderer.getQualities();
        console.log('Detected qualities:', qualities);
      }
    });

    // Console helper message
    console.log('%cüé¨ VidPly Quality Test', 'font-size: 20px; font-weight: bold; color: #2196f3;');
    console.log('%cPlayers available:', 'color: #4caf50;');
    console.log('  - window.hlsPlayer (HLS streaming)');
    console.log('  - window.multiQualityPlayer (Multiple sources)');
    console.log('%cTry:', 'color: #ccc;');
    console.log('  window.hlsPlayer.renderer.getQualities()');
    console.log('  window.multiQualityPlayer.renderer.getQualities()');
  </script>
</body>
</html>

